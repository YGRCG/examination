# 医院体检项目智能推荐系统产品设计书

## 1. 技术栈推荐

### 1.1 前端技术栈
- **框架**：Vue 3 + Vite
- **UI 组件库**：Element Plus（移动端可使用 Vant）
- **状态管理**：Pinia
- **路由**：Vue Router
- **HTTP 客户端**：Axios
- **语音交互**：Web Speech API（语音识别和合成）
- **文件处理**：PDF.js（PDF文件解析）
- **构建工具**：Vite

### 1.2 后端技术栈
- **框架**：FastAPI
- **异步支持**：Python AsyncIO
- **ORM**：SQLAlchemy
- **身份验证**：JWT (JSON Web Tokens)
- **文件上传**：FastAPI UploadFile
- **语音处理**：可集成第三方语音识别 API 或使用本地模型
- **报告分析**：可集成 OCR 服务进行图像文本提取

### 1.3 数据库
- **主数据库**：PostgreSQL（存储结构化数据）
- **缓存**：Redis（会话管理、热点数据缓存）
- **文件存储**：对象存储服务（如 AWS S3、阿里云 OSS）用于存储体检报告等文件

## 2. 数据库设计

### 2.1 用户表 (users)
- `id` (主键)：用户唯一标识
- `username`：用户名
- `password_hash`：密码哈希
- `phone_number`：手机号码
- `email`：电子邮箱
- `created_at`：创建时间
- `updated_at`：更新时间
- `last_login_at`：最后登录时间

### 2.2 用户信息表 (user_profiles)
- `id` (主键)
- `user_id` (外键，关联 users.id)
- `age`：年龄
- `gender`：性别
- `marital_status`：婚姻状况
- `height`：身高
- `weight`：体重
- `allergies`：过敏史
- `chronic_diseases`：慢性病史
- `surgeries`：手术史
- `family_medical_history`：家族病史
- `smoking_status`：吸烟状况
- `drinking_status`：饮酒状况
- `exercise_habits`：运动习惯
- `sleep_quality`：睡眠质量
- `created_at`：创建时间
- `updated_at`：更新时间

### 2.3 体检项目表 (examination_items)
- `id` (主键)
- `name`：项目名称
- `description`：项目描述
- `category`：项目类别（如内科、外科、影像科等）
- `price`：价格
- `duration`：预计检查时长
- `is_common`：是否为常规项目

### 2.4 体检套餐表 (examination_packages)
- `id` (主键)
- `name`：套餐名称
- `description`：套餐描述
- `price`：套餐价格
- `target_group`：目标人群
- `recommended_frequency`：推荐检查频率

### 2.5 套餐项目关联表 (package_items)
- `id` (主键)
- `package_id` (外键，关联 examination_packages.id)
- `item_id` (外键，关联 examination_items.id)
- `item_quantity`：项目数量（如某些项目可能需要多次检查）

### 2.6 推荐记录表 (recommendations)
- `id` (主键)
- `user_id` (外键，关联 users.id)
- `profile_id` (外键，关联 user_profiles.id)
- `recommended_package_id` (外键，关联 examination_packages.id)
- `recommendation_reason`：推荐理由
- `recommended_at`：推荐时间

### 2.7 预约表 (appointments)
- `id` (主键)
- `user_id` (外键，关联 users.id)
- `package_id` (外键，关联 examination_packages.id)
- `appointment_date`：预约日期
- `appointment_time`：预约时间
- `status`：预约状态（待确认、已确认、已完成、已取消等）
- `created_at`：创建时间
- `updated_at`：更新时间

### 2.8 体检报告表 (examination_reports)
- `id` (主键)
- `user_id` (外键，关联 users.id)
- `appointment_id` (外键，关联 appointments.id)
- `report_url`：报告文件存储路径
- `report_date`：报告生成日期
- `summary`：报告摘要
- `abnormal_items`：异常项目（JSON 格式存储）
- `doctor_comments`：医生评语
- `is_interpreted`：是否已解读

### 2.9 对话记录表 (conversations)
- `id` (主键)
- `user_id` (外键，关联 users.id)
- `message_content`：消息内容
- `message_type`：消息类型（text, voice）
- `sender`：发送者（user, system）
- `sent_at`：发送时间
- `session_id`：会话 ID（用于多轮对话上下文管理）

## 3. 接口规范

### 3.1 统一请求/响应格式

#### 请求格式
```json
{
  "data": {}
}
```

#### 成功响应格式
```json
{
  "code": 200,
  "message": "Success",
  "data": {}
}
```

#### 错误响应格式
```json
{
  "code": 错误码,
  "message": "错误信息",
  "error": "详细错误描述"
}
```

### 3.2 API 版本控制
所有 API 接口应包含版本号，如 `/api/v1/users`

### 3.3 认证与授权
- 使用 JWT 进行身份验证
- 请求头中包含 `Authorization: Bearer {token}`

## 4. 模块及功能详细描述

### 4.1 用户管理模块
- 用户注册与登录（手机号/邮箱验证）
- 个人信息管理与修改
- 密码重置与安全设置

### 4.2 智能交互模块
- **文字交互**：支持用户通过文字输入进行问答交流
- **语音交互**：支持语音输入识别和语音合成响应
- **多轮对话管理**：维护对话上下文，提供连贯的交互体验
- **常见问题自动回答**：快速响应用户常见疑问

### 4.3 信息收集模块
- 基础信息采集（年龄、性别、婚姻状况等）
- 健康史收集（既往病史、手术史、过敏史等）
- 生活习惯收集（吸烟、饮酒、运动、睡眠等）
- 家族病史收集
- 文件上传（历史体检报告 PDF、图片等）
- 用户画像生成

### 4.4 智能推荐模块
- 基于用户画像和健康数据进行体检项目智能匹配
- 提供多个推荐方案及推荐理由
- 支持用户自定义调整推荐项目
- 推荐结果展示与对比

### 4.5 预约管理模块
- 体检时间/地点选择与预约
- 预约确认与提醒
- 预约状态查询与修改
- 体检注意事项告知

### 4.6 报告管理模块
- 体检报告上传与存储
- 报告查看与下载
- 报告内容解析与结构化
- 异常指标识别与标记
- 历史报告对比分析

### 4.7 报告解读模块
- **数字人解读**：通过数字人形象对报告重点内容进行解读
- **异常指标解释**：对异常检查结果提供专业解释
- **健康建议生成**：基于报告结果提供个性化健康干预建议
- **报告分享**：支持将报告分享给医生或家属

### 4.8 系统管理模块
- 用户管理：用户列表、权限管理
- 体检项目/套餐管理：增删改查操作
- 推荐算法参数配置与优化
- 数据统计分析与报表生成
- 系统日志监控与管理

## 5. 前端页面设计

### 5.1 首页/欢迎页
- 系统介绍与主要功能入口
- 用户登录/注册入口
- 快速开始体检推荐流程的入口

### 5.2 登录/注册页
- 账号密码登录
- 手机号/邮箱验证码登录
- 新用户注册表单
- 忘记密码流程

### 5.3 个人中心页
- 用户基本信息展示
- 个人资料编辑入口
- 历史记录查看入口（体检、报告、预约等）

### 5.4 智能交互页（核心页面）
- 聊天对话框样式，展示系统与用户的交互内容
- 语音输入按钮（支持长按录音）
- 文字输入框
- 语音播放按钮（播放系统语音回复）
- 文件上传入口（支持拖拽上传）

### 5.5 信息收集页
- 分步式表单，引导用户填写各项信息
- 每步包含相关健康问题
- 进度指示器显示填写进度
- 保存草稿功能

### 5.6 推荐结果页
- 展示多个推荐套餐方案
- 每个方案包含名称、价格、包含项目、推荐理由等信息
- 支持方案对比功能
- 添加/删除项目功能
- 选择方案并进入预约流程的入口

### 5.7 预约管理页
- 显示当前和历史预约记录
- 预约日历选择器
- 时间段选择器
- 预约确认信息展示
- 体检前注意事项提醒

### 5.8 报告管理页
- 历史报告列表
- 报告上传按钮
- 报告详情查看入口
- 报告分享功能

### 5.9 报告解读页
- 数字人视频/动画展示区域
- 报告重点内容文本展示
- 异常指标高亮显示
- 健康建议文本展示
- 语音播放控制

### 5.10 系统设置页
- 语言设置
- 通知设置
- 隐私设置
- 清除缓存等功能

## 6. 系统流程概述

1. **用户注册/登录**：用户通过手机号或邮箱注册并登录系统
2. **信息采集**：系统通过智能交互方式收集用户健康相关信息
3. **画像生成**：基于收集的信息生成用户健康画像
4. **智能推荐**：根据用户画像推荐个性化体检套餐
5. **预约体检**：用户选择套餐并预约体检时间地点
6. **体检报告管理**：上传、查看和管理体检报告
7. **报告解读**：数字人为用户解读报告重点内容并提供健康建议
8. **健康管理**：持续跟踪用户健康状况，提供后续健康管理建议

以上设计覆盖了医院体检项目智能推荐系统的核心功能和技术实现方案，可以根据实际需求和资源情况进行阶段性开发和优化。