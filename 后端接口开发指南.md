# 医院体检项目智能推荐系统 - 后端接口开发指南

## 1. 接口设计规范

### 1.1 基础规范
- **技术栈**：FastAPI
- **接口路径**：统一前缀 `/api/v1/`
- **认证方式**：JWT (请求头中添加 `Authorization: Bearer {token}`)
- **请求/响应格式**：JSON

### 1.2 统一响应格式
所有接口响应必须包含以下三个字段：
```json
{
  "status": "success"或"error",
  "message": "描述信息",
  "data": {}
}
```

## 2. 用户管理模块

### 2.1 用户认证

#### 2.1.1 用户注册
- **请求地址**：`/api/v1/auth/register`
- **请求方式**：POST
- **请求参数**：
  ```json
  {
    "username": "用户名",
    "password": "密码",
    "phone_number": "手机号码",
    "email": "电子邮箱(可选)"
  }
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "注册成功",
    "data": {
      "user_id": "用户ID",
      "username": "用户名"
    }
  }
  ```

#### 2.1.2 用户登录
- **请求地址**：`/api/v1/auth/login`
- **请求方式**：POST
- **请求参数**：
  ```json
  {
    "username": "用户名",
    "password": "密码"
  }
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "登录成功",
    "data": {
      "user_id": "用户ID",
      "username": "用户名",
      "token": "JWT令牌",
      "expires_at": "令牌过期时间"
    }
  }
  ```

#### 2.1.3 密码重置
- **请求地址**：`/api/v1/auth/reset-password`
- **请求方式**：POST
- **请求参数**：
  ```json
  {
    "phone_number": "手机号码",
    "new_password": "新密码",
    "verification_code": "验证码"
  }
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "密码重置成功",
    "data": null
  }
  ```

### 2.2 用户信息管理

#### 2.2.1 获取个人信息
- **请求地址**：`/api/v1/users/profile`
- **请求方式**：GET
- **请求参数**：无(通过JWT获取用户ID)
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "获取成功",
    "data": {
      "id": "用户ID",
      "username": "用户名",
      "phone_number": "手机号码",
      "email": "电子邮箱",
      "profile": {
        "age": 年龄,
        "gender": "性别",
        "marital_status": "婚姻状况",
        "height": 身高,
        "weight": 体重,
        "allergies": "过敏史",
        "chronic_diseases": "慢性病史",
        "surgeries": "手术史",
        "family_medical_history": "家族病史",
        "smoking_status": "吸烟状况",
        "drinking_status": "饮酒状况",
        "exercise_habits": "运动习惯",
        "sleep_quality": "睡眠质量"
      }
    }
  }
  ```

#### 2.2.2 更新个人信息
- **请求地址**：`/api/v1/users/profile`
- **请求方式**：PUT
- **请求参数**：
  ```json
  {
    "phone_number": "手机号码(可选)",
    "email": "电子邮箱(可选)",
    "profile": {
      "age": 年龄,
      "gender": "性别",
      "marital_status": "婚姻状况",
      "height": 身高,
      "weight": 体重,
      "allergies": "过敏史",
      "chronic_diseases": "慢性病史",
      "surgeries": "手术史",
      "family_medical_history": "家族病史",
      "smoking_status": "吸烟状况",
      "drinking_status": "饮酒状况",
      "exercise_habits": "运动习惯",
      "sleep_quality": "睡眠质量"
    }
  }
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "更新成功",
    "data": {
      "id": "用户ID",
      "username": "用户名",
      "phone_number": "手机号码",
      "email": "电子邮箱",
      "profile": "更新后的用户资料"
    }
  }
  ```

## 3. 智能交互模块

### 3.1 对话管理

#### 3.1.1 发送文字消息
- **请求地址**：`/api/v1/chat/message`
- **请求方式**：POST
- **请求参数**：
  ```json
  {
    "content": "消息内容",
    "session_id": "会话ID(可选，无则创建新会话)"
  }
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "消息发送成功",
    "data": {
      "session_id": "会话ID",
      "response": "系统回复",
      "message_id": "消息ID"
    }
  }
  ```

#### 3.1.2 发送语音消息
- **请求地址**：`/api/v1/chat/voice`
- **请求方式**：POST
- **请求参数**：(Form-data)
  ```
  voice_file: (音频文件)
  session_id: (会话ID，可选)
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "语音消息处理成功",
    "data": {
      "session_id": "会话ID",
      "transcribed_text": "语音转文字结果",
      "response": "系统回复",
      "voice_response_url": "语音回复文件URL(可选)"
    }
  }
  ```

#### 3.1.3 获取会话历史
- **请求地址**：`/api/v1/chat/history`
- **请求方式**：GET
- **请求参数**：
  ```
  ?session_id=会话ID&page=页码&page_size=每页条数
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "获取成功",
    "data": {
      "messages": [
        {
          "id": "消息ID",
          "content": "消息内容",
          "message_type": "text/voice",
          "sender": "user/system",
          "sent_at": "发送时间"
        }
      ],
      "total": 总消息数,
      "page": 当前页码,
      "page_size": 每页条数
    }
  }
  ```

## 4. 信息收集模块

### 4.1 健康信息收集

#### 4.1.1 提交健康信息
- **请求地址**：`/api/v1/health-info/submit`
- **请求方式**：POST
- **请求参数**：
  ```json
  {
    "basic_info": {
      "age": 年龄,
      "gender": "性别",
      "marital_status": "婚姻状况"
    },
    "health_history": {
      "allergies": ["过敏史1", "过敏史2"],
      "chronic_diseases": ["慢性病1", "慢性病2"],
      "surgeries": ["手术史1"],
      "family_medical_history": ["家族病史1"]
    },
    "lifestyle": {
      "smoking_status": "吸烟状况",
      "drinking_status": "饮酒状况",
      "exercise_habits": "运动习惯",
      "sleep_quality": "睡眠质量"
    }
  }
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "信息提交成功",
    "data": {
      "profile_id": "用户资料ID",
      "submitted_at": "提交时间"
    }
  }
  ```

#### 4.1.2 上传历史体检报告
- **请求地址**：`/api/v1/health-info/upload-report`
- **请求方式**：POST
- **请求参数**：(Form-data)
  ```
  report_file: (PDF或图片文件)
  report_type: ("pdf"或"image")
  report_date: (报告日期，可选)
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "报告上传成功",
    "data": {
      "file_id": "文件ID",
      "file_url": "文件存储URL",
      "uploaded_at": "上传时间"
    }
  }
  ```

#### 4.1.3 生成用户画像
- **请求地址**：`/api/v1/health-info/generate-profile`
- **请求方式**：GET
- **请求参数**：无
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "用户画像生成成功",
    "data": {
      "profile_id": "画像ID",
      "health_risk_factors": ["风险因素1", "风险因素2"],
      "recommended_checkups": ["推荐检查1", "推荐检查2"],
      "generated_at": "生成时间"
    }
  }
  ```

## 5. 智能推荐模块

### 5.1 体检套餐推荐

#### 5.1.1 获取推荐套餐
- **请求地址**：`/api/v1/recommendations/get`
- **请求方式**：GET
- **请求参数**：
  ```
  ?profile_id=用户画像ID(可选，无则使用最新)
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "推荐获取成功",
    "data": {
      "recommendations": [
        {
          "id": "推荐ID",
          "package_id": "套餐ID",
          "package_name": "套餐名称",
          "package_description": "套餐描述",
          "price": 价格,
          "recommendation_reason": "推荐理由",
          "items": [
            {
              "item_id": "项目ID",
              "item_name": "项目名称",
              "item_description": "项目描述"
            }
          ]
        }
      ],
      "recommended_at": "推荐时间"
    }
  }
  ```

#### 5.1.2 调整推荐项目
- **请求地址**：`/api/v1/recommendations/customize`
- **请求方式**：POST
- **请求参数**：
  ```json
  {
    "recommendation_id": "推荐ID",
    "added_items": ["项目ID1", "项目ID2"],
    "removed_items": ["项目ID3"]
  }
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "推荐调整成功",
    "data": {
      "custom_recommendation_id": "自定义推荐ID",
      "updated_package": {
        "name": "更新后的套餐名称",
        "price": 价格,
        "items": ["项目列表"]
      }
    }
  }
  ```

#### 5.1.3 获取体检项目列表
- **请求地址**：`/api/v1/examination/items`
- **请求方式**：GET
- **请求参数**：
  ```
  ?category=项目类别&is_common=true/false&page=页码&page_size=每页条数
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "获取成功",
    "data": {
      "items": [
        {
          "id": "项目ID",
          "name": "项目名称",
          "description": "项目描述",
          "category": "项目类别",
          "price": 价格,
          "duration": "预计检查时长",
          "is_common": true/false
        }
      ],
      "total": 总项目数,
      "page": 当前页码,
      "page_size": 每页条数
    }
  }
  ```

## 6. 预约管理模块

### 6.1 预约操作

#### 6.1.1 创建预约
- **请求地址**：`/api/v1/appointments/create`
- **请求方式**：POST
- **请求参数**：
  ```json
  {
    "package_id": "套餐ID",
    "appointment_date": "预约日期(YYYY-MM-DD)",
    "appointment_time": "预约时间段",
    "custom_items": ["自定义项目ID列表(可选)"]
  }
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "预约创建成功",
    "data": {
      "appointment_id": "预约ID",
      "package_name": "套餐名称",
      "appointment_date": "预约日期",
      "appointment_time": "预约时间",
      "status": "待确认",
      "notice": "体检注意事项"
    }
  }
  ```

#### 6.1.2 获取预约列表
- **请求地址**：`/api/v1/appointments/list`
- **请求方式**：GET
- **请求参数**：
  ```
  ?status=预约状态(可选)&start_date=开始日期&end_date=结束日期&page=页码&page_size=每页条数
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "获取成功",
    "data": {
      "appointments": [
        {
          "id": "预约ID",
          "package_id": "套餐ID",
          "package_name": "套餐名称",
          "appointment_date": "预约日期",
          "appointment_time": "预约时间",
          "status": "预约状态",
          "created_at": "创建时间"
        }
      ],
      "total": 总预约数,
      "page": 当前页码,
      "page_size": 每页条数
    }
  }
  ```

#### 6.1.3 修改预约
- **请求地址**：`/api/v1/appointments/{appointment_id}`
- **请求方式**：PUT
- **请求参数**：
  ```json
  {
    "appointment_date": "新预约日期(可选)",
    "appointment_time": "新预约时间段(可选)",
    "status": "新状态(可选，如取消预约)"
  }
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "预约更新成功",
    "data": {
      "appointment_id": "预约ID",
      "updated_fields": {"更新的字段": "更新后的值"}
    }
  }
  ```

## 7. 报告管理模块

### 7.1 报告操作

#### 7.1.1 上传体检报告
- **请求地址**：`/api/v1/reports/upload`
- **请求方式**：POST
- **请求参数**：(Form-data)
  ```
  report_file: (PDF或图片文件)
  appointment_id: (关联的预约ID)
  report_date: (报告日期，可选)
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "报告上传成功",
    "data": {
      "report_id": "报告ID",
      "report_url": "报告URL",
      "uploaded_at": "上传时间"
    }
  }
  ```

#### 7.1.2 获取报告列表
- **请求地址**：`/api/v1/reports/list`
- **请求方式**：GET
- **请求参数**：
  ```
  ?is_interpreted=true/false&page=页码&page_size=每页条数
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "获取成功",
    "data": {
      "reports": [
        {
          "id": "报告ID",
          "appointment_id": "预约ID",
          "report_date": "报告日期",
          "summary": "报告摘要",
          "is_interpreted": true/false,
          "report_url": "报告URL",
          "created_at": "上传时间"
        }
      ],
      "total": 总报告数,
      "page": 当前页码,
      "page_size": 每页条数
    }
  }
  ```

#### 7.1.3 获取报告详情
- **请求地址**：`/api/v1/reports/{report_id}`
- **请求方式**：GET
- **请求参数**：无
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "获取成功",
    "data": {
      "id": "报告ID",
      "appointment_id": "预约ID",
      "report_date": "报告日期",
      "summary": "报告摘要",
      "abnormal_items": [
        {
          "item_name": "异常项目名称",
          "value": "检测值",
          "reference_range": "参考范围",
          "description": "描述"
        }
      ],
      "doctor_comments": "医生评语",
      "is_interpreted": true/false,
      "report_url": "报告URL",
      "created_at": "上传时间"
    }
  }
  ```

## 8. 报告解读模块

### 8.1 报告解读操作

#### 8.1.1 解读体检报告
- **请求地址**：`/api/v1/reports/{report_id}/interpret`
- **请求方式**：POST
- **请求参数**：
  ```json
  {
    "interpret_type": "summary/detail" // 简要解读或详细解读
  }
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "报告解读成功",
    "data": {
      "report_id": "报告ID",
      "interpretation": {
        "key_findings": "主要发现",
        "abnormal_explanations": [
          {
            "item_name": "异常项目名称",
            "explanation": "解释",
            "recommendations": "建议"
          }
        ],
        "health_advice": "健康建议",
        "next_steps": "下一步建议"
      },
      "digital_human_video_url": "数字人解读视频URL(可选)",
      "interpreted_at": "解读时间"
    }
  }
  ```

#### 8.1.2 获取解读结果
- **请求地址**：`/api/v1/reports/{report_id}/interpretation`
- **请求方式**：GET
- **请求参数**：无
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "获取成功",
    "data": {
      "report_id": "报告ID",
      "interpretation": {
        "key_findings": "主要发现",
        "abnormal_explanations": [
          {
            "item_name": "异常项目名称",
            "explanation": "解释",
            "recommendations": "建议"
          }
        ],
        "health_advice": "健康建议",
        "next_steps": "下一步建议"
      },
      "digital_human_video_url": "数字人解读视频URL",
      "interpreted_at": "解读时间"
    }
  }
  ```

#### 8.1.3 分享报告解读
- **请求地址**：`/api/v1/reports/{report_id}/share`
- **请求方式**：POST
- **请求参数**：
  ```json
  {
    "share_to": "分享对象的邮箱/手机号",
    "share_type": "email/sms",
    "expires_in": 有效期(天数，可选)
  }
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "报告分享成功",
    "data": {
      "share_id": "分享ID",
      "shared_to": "分享对象",
      "share_link": "分享链接(如果有)",
      "expires_at": "过期时间"
    }
  }
  ```

## 9. 系统管理模块

### 9.1 系统配置和监控

#### 9.1.1 获取系统状态
- **请求地址**：`/api/v1/admin/system/status`
- **请求方式**：GET
- **请求参数**：无
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "获取成功",
    "data": {
      "database": "数据库连接状态",
      "redis": "Redis连接状态",
      "memory_usage": "内存使用情况",
      "cpu_usage": "CPU使用情况",
      "active_users": "活跃用户数"
    }
  }
  ```

#### 9.1.2 获取系统日志
- **请求地址**：`/api/v1/admin/system/logs`
- **请求方式**：GET
- **请求参数**：
  ```
  ?level=日志级别&start_time=开始时间&end_time=结束时间&page=页码&page_size=每页条数
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "获取成功",
    "data": {
      "logs": [
        {
          "id": "日志ID",
          "level": "日志级别",
          "message": "日志内容",
          "source": "日志来源",
          "timestamp": "日志时间"
        }
      ],
      "total": 总日志数,
      "page": 当前页码,
      "page_size": 每页条数
    }
  }
  ```

#### 9.1.3 数据统计分析
- **请求地址**：`/api/v1/admin/statistics`
- **请求方式**：GET
- **请求参数**：
  ```
  ?type=统计类型(user/appointment/report)&start_date=开始日期&end_date=结束日期
  ```
- **响应内容**：
  ```json
  {
    "status": "success",
    "message": "获取成功",
    "data": {
      "type": "统计类型",
      "total_count": "总数量",
      "trend_data": [
        {"date": "日期", "count": "数量"}
      ],
      "breakdown": {"分类统计": "数值"}
    }
  }
  ```

## 10. 错误处理规范

### 10.1 常见错误码
- **400**：请求参数错误
- **401**：未授权，需要登录
- **403**：禁止访问，权限不足
- **404**：资源不存在
- **405**：请求方法不允许
- **500**：服务器内部错误

### 10.2 错误响应示例
```json
{
  "status": "error",
  "message": "请求参数错误",
  "data": {
    "error_code": "INVALID_PARAMS",
    "error_details": {
      "field_name": "错误原因"
    }
  }
}
```

## 11. 安全规范

1. 所有敏感数据（如密码）必须加密存储
2. 接口请求必须进行身份验证和权限校验
3. 文件上传必须进行类型和大小限制
4. 防止SQL注入、XSS攻击等常见安全问题
5. 敏感操作需要二次确认

本接口开发指南基于产品设计书的功能需求，提供了完整的后端API设计方案。接口遵循RESTful设计原则，使用统一的响应格式，便于前端开发和系统集成。实际开发过程中，可根据具体需求进行调整和扩展。